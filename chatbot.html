<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCK AI Chatbot (Clean Luxury Edition)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Be Vietnam Pro & JetBrains Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Be Vietnam Pro', 'sans-serif'], 
                        mono: ['JetBrains Mono', 'monospace'] 
                    },
                    colors: {
                        cyber: {
                            dark: '#020617',
                            panel: '#0f172a',
                            primary: '#06b6d4',
                            glow: '#22d3ee',
                            accent: '#6366f1',
                            text: '#e2e8f0'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        glow: {
                            '0%': { boxShadow: '0 0 5px #06b6d4, 0 0 10px #06b6d4' },
                            '100%': { boxShadow: '0 0 10px #22d3ee, 0 0 20px #22d3ee' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CLEAN TECH BACKGROUND --- */
        .tech-bg {
            background-color: #020617;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(6, 182, 212, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(99, 102, 241, 0.08) 0%, transparent 25%);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #334155; }

        /* --- MARKDOWN STYLES --- */
        .markdown-body { font-size: 0.95rem; line-height: 1.7; color: #e2e8f0; }
        .markdown-body p { margin-bottom: 0.75rem; }
        .markdown-body strong { color: #67e8f9; font-weight: 600; }
        .markdown-body em { color: #a5b4fc; }
        .markdown-body code { 
            font-family: 'JetBrains Mono', monospace; 
            background: rgba(15, 23, 42, 0.8); 
            padding: 0.2em 0.4em; 
            border-radius: 4px; 
            color: #22d3ee; 
            font-size: 0.85em;
        }
        .markdown-body pre { 
            background: #0f172a; 
            padding: 1rem; 
            border-radius: 8px; 
            overflow-x: auto; 
            margin: 0.5rem 0;
            border: 1px solid #1e293b;
        }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 0.75rem; }
        .markdown-body ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 0.75rem; }
        .markdown-body a { color: #38bdf8; text-decoration: none; border-bottom: 1px dashed #38bdf8; transition: all 0.2s; }
        .markdown-body a:hover { color: #22d3ee; border-bottom-style: solid; }
        .markdown-body blockquote { 
            border-left: 3px solid #6366f1; 
            padding-left: 1rem; 
            color: #94a3b8; 
            font-style: italic;
            margin: 0.5rem 0;
        }

        /* --- UTILITIES --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .message-animation {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="tech-bg h-screen flex items-center justify-center font-sans text-cyber-text overflow-hidden selection:bg-cyber-primary selection:text-white">

    <!-- MAIN CONTAINER -->
    <div class="w-full h-full max-w-5xl md:h-[90vh] md:w-[95vw] md:rounded-2xl glass-panel shadow-2xl flex flex-col relative overflow-hidden border border-slate-800/50">
        
        <!-- HEADER -->
        <header class="h-16 px-6 border-b border-slate-800/50 flex items-center justify-between bg-slate-900/50">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-wide text-white flex items-center gap-2">
                        BCK AI <span class="px-1.5 py-0.5 rounded text-[10px] font-mono bg-cyan-500/10 text-cyan-400 border border-cyan-500/20">BOT</span>
                    </h1>
                    <div class="flex items-center gap-2">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                        </span>
                        <span class="text-xs text-slate-400 font-mono tracking-wider">S·∫µn s√†ng h·ªó tr·ª£</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-1">
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
            </div>
        </header>

        <!-- CHAT AREA -->
        <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-6 scroll-smooth">
            <!-- Bot Welcome Message -->
            <div class="flex gap-4 message-animation">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex-shrink-0 flex items-center justify-center mt-1 shadow-md shadow-cyan-500/10">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div class="flex flex-col gap-1 max-w-[85%]">
                    <span class="text-xs font-mono text-cyan-400 font-medium tracking-wider mb-1 flex items-center gap-2">
                        BOT STARTING
                    </span>
                    <div class="p-4 rounded-2xl rounded-tl-none bg-slate-800/80 border border-slate-700/50 shadow-sm backdrop-blur-sm">
                        <div class="markdown-body">
                            <p>Ch√†o b·∫°n! üëã M√¨nh l√† <strong>BCK AI</strong>.</p>
                            <p>M√¨nh c√≥ th·ªÉ gi√∫p b·∫°n t√¨m s√°ch, tra c·ª©u th√¥ng tin th∆∞ vi·ªán, ho·∫∑c <strong>tr√≤ chuy·ªán t·ª± do</strong> v·ªÅ b·∫•t c·ª© ch·ªß ƒë·ªÅ g√¨ nh√©! üòâ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- INPUT AREA -->
        <div class="p-4 border-t border-slate-800/50 bg-slate-900/30 backdrop-blur-md">
            <!-- Toolbar -->
            <div class="flex justify-between items-center mb-2 px-1">
                 <button id="clear-btn" class="text-xs text-slate-500 hover:text-red-400 transition-colors flex items-center gap-1.5 group">
                    <svg class="w-3.5 h-3.5 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    X√≥a b·ªô nh·ªõ
                </button>
                <div class="text-[10px] font-mono text-slate-600 tracking-widest uppercase">Powered by Gemini</div>
            </div>

            <!-- Input Box -->
            <div class="relative group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl opacity-20 group-hover:opacity-40 transition duration-500 blur"></div>
                <div class="relative flex items-end bg-slate-900 rounded-xl border border-slate-700 p-1.5 focus-within:border-cyan-500/50 transition-colors">
                    <textarea 
                        id="user-input" 
                        rows="1" 
                        placeholder="Nh·∫≠p tin nh·∫Øn..." 
                        class="w-full bg-transparent text-slate-200 placeholder-slate-500 text-sm px-4 py-3 focus:outline-none resize-none max-h-32"
                        oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                    
                    <button id="send-btn" class="p-2.5 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white shadow-lg shadow-cyan-500/20 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed mb-0.5 mr-0.5">
                        <svg class="w-5 h-5 transform rotate-90" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // --- CONFIGURATION ---
        // L∆∞u √Ω: ƒê√¢y l√† client-side, key s·∫Ω b·ªã l·ªô n·∫øu publish.
        // Trong th·ª±c t·∫ø n√™n g·ªçi qua backend.
        const API_KEY = ""; // ƒê·ªÉ tr·ªëng, s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn t·ª± ƒë·ªông trong m√¥i tr∆∞·ªùng demo
        
        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const clearBtn = document.getElementById('clear-btn');

        // State
        let chatHistory = [];
        let isGenerating = false;

        // Initialize Gemini (Handle empty key gracefully for UI demo)
        let genAI, model;
        try {
            if (API_KEY) {
                genAI = new GoogleGenerativeAI(API_KEY);
                model = genAI.getGenerativeModel({ model: "gemini-pro" });
            }
        } catch (e) {
            console.warn("Gemini init failed:", e);
        }

        // --- FUNCTIONS ---

        function addMessage(role, text) {
            const isUser = role === 'user';
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-4 message-animation ${isUser ? 'flex-row-reverse' : ''}`;
            
            const avatar = isUser 
                ? `<div class="w-8 h-8 rounded-full bg-slate-700 flex-shrink-0 flex items-center justify-center mt-1 border border-slate-600"><svg class="w-4 h-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div>`
                : `<div class="w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex-shrink-0 flex items-center justify-center mt-1 shadow-md shadow-cyan-500/10"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>`;

            const label = isUser 
                ? '' 
                : `<span class="text-xs font-mono text-cyan-400 font-medium tracking-wider mb-1 flex items-center gap-2">BCK AI</span>`;

            const bubbleClass = isUser
                ? "bg-cyan-600/20 border border-cyan-500/30 text-cyan-50 rounded-tr-none"
                : "bg-slate-800/80 border border-slate-700/50 text-slate-200 rounded-tl-none shadow-sm backdrop-blur-sm";

            // Process Markdown for bot, simple text for user to prevent XSS
            const contentHtml = isUser 
                ? `<p>${escapeHtml(text)}</p>` 
                : marked.parse(text);

            msgDiv.innerHTML = `
                ${avatar}
                <div class="flex flex-col gap-1 max-w-[85%] ${isUser ? 'items-end' : 'items-start'}">
                    ${label}
                    <div class="p-3.5 px-5 rounded-2xl ${bubbleClass} text-sm leading-relaxed overflow-hidden">
                        <div class="markdown-body">${contentHtml}</div>
                    </div>
                </div>
            `;

            chatContainer.appendChild(msgDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex gap-4 message-animation';
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex-shrink-0 flex items-center justify-center mt-1 opacity-50">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div class="flex flex-col gap-1">
                    <div class="p-4 rounded-2xl rounded-tl-none bg-slate-800/50 border border-slate-700/30 w-16 h-10 flex items-center justify-center gap-1">
                        <div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div>
                        <div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div>
                        <div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function handleSend() {
            const text = userInput.value.trim();
            if (!text || isGenerating) return;

            // UI Updates
            userInput.value = '';
            userInput.style.height = 'auto';
            addMessage('user', text);
            isGenerating = true;
            sendBtn.disabled = true;

            const typingId = showTypingIndicator();

            try {
                // Check if API Key is available
                // Note: For this demo, we mock the response if no key or simple logic
                // In real app, call your backend or Gemini API here
                
                let responseText = "";

                if (typeof API_KEY !== 'undefined' && API_KEY !== "") {
                     // Real API Call logic would go here
                     // const chat = model.startChat({ history: chatHistory });
                     // const result = await chat.sendMessage(text);
                     // responseText = result.response.text();
                     
                     // SIMULATED DELAY FOR DEMO
                     await new Promise(r => setTimeout(r, 1500));
                     responseText = "H·ªá th·ªëng ƒëang ch·∫°y ·ªü ch·∫ø ƒë·ªô demo (kh√¥ng c√≥ API Key). Nh∆∞ng c√¢u h·ªèi c·ªßa b·∫°n l√†: **" + text + "**";
                } else {
                     // MOCK RESPONSE
                     await new Promise(r => setTimeout(r, 1000));
                     
                     // Simple Keyword matching for demo fun
                     const lowerText = text.toLowerCase();
                     if (lowerText.includes('xin ch√†o') || lowerText.includes('hi')) {
                         responseText = "Ch√†o b·∫°n! M√¨nh c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?";
                     } else if (lowerText.includes('th∆∞ vi·ªán') || lowerText.includes('s√°ch')) {
                         responseText = "Th∆∞ vi·ªán hi·ªán ƒëang m·ªü c·ª≠a. B·∫°n mu·ªën t√¨m s√°ch thu·ªôc th·ªÉ lo·∫°i n√†o? (VƒÉn h·ªçc, Khoa h·ªçc, Kinh t·∫ø...)";
                     } else if (lowerText.includes('c·∫£m ∆°n')) {
                         responseText = "Kh√¥ng c√≥ chi! R·∫•t vui ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n. üòä";
                     } else {
                         responseText = "C·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t c√¢u h·ªèi. ƒê√¢y l√† ph·∫£n h·ªìi m·∫´u t·ª´ giao di·ªán **BCK AI Chatbot**. \n\nƒê·ªÉ h·ªá th·ªëng ho·∫°t ƒë·ªông th·ª±c t·∫ø, vui l√≤ng t√≠ch h·ª£p API Key v√†o m√£ ngu·ªìn.";
                     }
                }

                removeTypingIndicator(typingId);
                addMessage('bot', responseText);
                
                // Update history (simplified)
                chatHistory.push({ role: "user", parts: text });
                chatHistory.push({ role: "model", parts: responseText });

            } catch (error) {
                console.error(error);
                removeTypingIndicator(typingId);
                addMessage('bot', "‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.");
            } finally {
                isGenerating = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        // --- EVENT LISTENERS ---
        
        sendBtn.addEventListener('click', handleSend);
        
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        clearBtn.addEventListener('click', () => {
            chatContainer.innerHTML = '';
            // Re-add Greeting
            const greetingHTML = `
            <div class="flex gap-4 message-animation">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex-shrink-0 flex items-center justify-center mt-1 shadow-md shadow-cyan-500/10">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div class="flex flex-col gap-1 max-w-[85%]">
                    <span class="text-xs font-mono text-cyan-400 font-medium tracking-wider mb-1 flex items-center gap-2">BOT GREETING</span>
                    <div class="p-4 rounded-2xl rounded-tl-none bg-slate-800/80 border border-slate-700/50 shadow-sm backdrop-blur-sm">
                        <div class="markdown-body">
                            <p>Ch√†o b·∫°n! üëã M√¨nh l√† <strong>BCK AI</strong>.</p>
                            <p>M√¨nh c√≥ th·ªÉ gi√∫p b·∫°n t√¨m s√°ch, tra c·ª©u th√¥ng tin th∆∞ vi·ªán, ho·∫∑c <strong>tr√≤ chuy·ªán t·ª± do</strong> v·ªÅ b·∫•t c·ª© ch·ªß ƒë·ªÅ g√¨ nh√©! üòâ</p>
                        </div>
                    </div>
                </div>
            </div>`;
            chatContainer.innerHTML = greetingHTML;
            chatHistory = [];
        });

    </script>
</body>
</html>